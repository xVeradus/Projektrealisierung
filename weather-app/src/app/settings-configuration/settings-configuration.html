<main>
  <div class="settings-shell" [formGroup]="form">
    <div class="controls">
      <div class="geo-input-group">
        <div class="field-item">
          <label for="lat">Latitude</label>
          <p-inputnumber formControlName="lat" mode="decimal" locale="en-US" [min]="-90" [max]="90"
            [minFractionDigits]="0" [maxFractionDigits]="6" [showButtons]="false" inputId="lat"
            styleClass="w-full"></p-inputnumber>
        </div>

        <div class="field-item">
          <label for="lon">Longitude</label>
          <p-inputnumber formControlName="lon" mode="decimal" locale="en-US" [min]="-180" [max]="180"
            [minFractionDigits]="0" [maxFractionDigits]="6" [showButtons]="false" inputId="lon"
            styleClass="w-full"></p-inputnumber>
        </div>

        <p-button label="Search Stations" icon="pi pi-search" styleClass="btn-search"
          (onClick)="searchStations()"></p-button>

      </div>

      <div class="slider-group">
        <div class="slider-item">
          <div class="slider-header">
            <label>Radius</label>
            <span class="value-badge">{{ form.get('radius_km')?.value }} km</span>
          </div>
          <p-slider formControlName="radius_km" [min]="1" [max]="200" styleClass="w-full"
            ariaLabel="Radius in km"></p-slider>
        </div>

        <div class="toggle-item">
          <label for="show-all-toggle">Show All Results</label>
          <p-toggleSwitch formControlName="show_all" inputId="show-all-toggle"
            ariaLabel="Toggle showing all results"></p-toggleSwitch>
        </div>

        <div class="slider-item" *ngIf="!form.get('show_all')?.value">
          <div class="slider-header">
            <label>Results Limit</label>
            <span class="value-badge">{{ form.get('limit')?.value }}</span>
          </div>
          <p-slider formControlName="limit" [min]="1" [max]="100" styleClass="w-full"
            ariaLabel="Results limit"></p-slider>
        </div>

        <div class="slider-item" *ngIf="!form.get('show_all')?.value">
          <div class="slider-header" style="margin-bottom: 8px;">
            <label style="margin: 0;">Data Year Range</label>
          </div>
          <div style="display: flex; gap: 12px; align-items: center;">
            <p-inputnumber formControlName="start_year" [min]="1900" [max]="2025" [useGrouping]="false"
              inputStyleClass="year-input-small" [showButtons]="false"></p-inputnumber>

            <div style="flex-grow: 1; padding-top: 6px;">
              <p-slider formControlName="year_range" [range]="true" [min]="1900" [max]="2025" styleClass="w-full"
                ariaLabel="Data availability year range"></p-slider>
            </div>

            <p-inputnumber formControlName="end_year" [min]="1900" [max]="2025" [useGrouping]="false"
              inputStyleClass="year-input-small" [showButtons]="false"></p-inputnumber>
          </div>
        </div>
      </div>
    </div>

    <div class="results" *ngIf="stations.length">
      <div class="results-title">Results</div>

      <div class="results-scroll">
        <div class="stations-list">
          <div class="station-card" *ngFor="let s of stations; trackBy: trackByStationId"
            (click)="openStationDialogFor(s.station_id)" (keydown.enter)="openStationDialogFor(s.station_id)"
            role="button" tabindex="0"
            [attr.aria-label]="'Wetterstation: ' + s.name + ', Entfernung: ' + (s.distance_km | number: '1.1-1') + ' km'">
            <div class="station-title">{{ s.name }}</div>
            <div class="station-distance">{{ s.distance_km | number: '1.1-1' }} km</div>
            <div class="station-coords">
              Lat {{ s.lat | number: '1.4-4' }}, Lon {{ s.lon | number: '1.4-4' }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>